<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>Multi bet editor - ConvertBetCodes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com/" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300..800&family=SUSE:wght@100..800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --adminuiux-content-font: "Open Sans", sans-serif;
        --adminuiux-title-font: "SUSE", sans-serif;
      }
    </style>
    <script defer src="assets/js/app8051.js?bd1e16b080f637e63a80"></script>
    <link href="assets/css/app8051.css?bd1e16b080f637e63a80" rel="stylesheet" />
    <link rel="stylesheet" href="./assets/css/bet-editor.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="./assets/css/betslip-rail.css" />
  </head>

  <body
    class="main-bg main-bg-opac adminuiux-header-standard theme-blue adminuiux-header-transparent adminuiux-sidebar-fill-white adminuiux-sidebar-standard bg-r-gradient scrollup"
  >
    <div id="desktop-nav"></div>
    <div id="side-menu"></div>

    <div class="adminuiux-wrap">
      <main class="adminuiux-content has-sidebar" onclick="contentClick()">
        
        <div class="">
          <div class="card bet-editor">
            <div class="page-header">
          <button class="back-btn" onclick="navigateTo('convert.html')">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M15 18l-6-6 6-6" />
            </svg>
          </button>
          <h1 class="page-title">Multi Bet Editor</h1>
          <button class="home-btn" onclick="navigateTo('index.html')">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
              <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
          </button>
            </div>

            <!-- Action Buttons (Primary CTAs) -->
            <div class="action-buttons">
              <button class="action-btn" id="load-code-btn">
                <i class="bi bi-plus-circle"></i>
                Load Code
              </button>
              <button class="action-btn" id="add-game-btn">
                <i class="bi bi-plus-circle"></i>
                Add Game
              </button>
            </div>

            <!-- Info Card (shown when betslip has items) -->
            <!-- <div class="editor-info-card" id="info-card" style="display: none">
              <div class="info-card-header">
                <div class="info-card-icon">
                  <i class="bi bi-check-circle-fill"></i>
                </div>
                <div class="info-card-content">
                  <h4 class="info-card-title">Your betslip is ready!</h4>
                  <p class="info-card-text">
                    You have <strong id="bet-count-info">0</strong> selections
                    in your betslip. Click the betslip badge at the bottom to
                    review, edit, or book your bets.
                  </p>
                </div>
              </div>
              <div class="info-card-btn" id="open-betslip-btn">
            
              </div>
            </div> -->

            <!-- Empty State -->
            <div class="empty-state" id="empty-state">
              <div class="empty-state-icon">
                <svg
                  width="120"
                  height="120"
                  viewBox="0 0 120 120"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <rect
                    x="20"
                    y="30"
                    width="80"
                    height="60"
                    rx="8"
                    stroke="#E0E0E0"
                    stroke-width="3"
                    fill="none"
                  />
                  <path
                    d="M30 45 L90 45"
                    stroke="#E0E0E0"
                    stroke-width="3"
                    stroke-linecap="round"
                  />
                  <circle cx="40" cy="60" r="8" fill="#E0E0E0" />
                  <rect
                    x="52"
                    y="55"
                    width="30"
                    height="4"
                    rx="2"
                    fill="#E0E0E0"
                  />
                  <rect
                    x="52"
                    y="63"
                    width="20"
                    height="3"
                    rx="1.5"
                    fill="#E0E0E0"
                  />
                  <circle cx="40" cy="78" r="8" fill="#E0E0E0" />
                  <rect
                    x="52"
                    y="73"
                    width="30"
                    height="4"
                    rx="2"
                    fill="#E0E0E0"
                  />
                  <rect
                    x="52"
                    y="81"
                    width="20"
                    height="3"
                    rx="1.5"
                    fill="#E0E0E0"
                  />
                </svg>
              </div>
              <p class="empty-state-text">No bets added yet</p>
              <p class="empty-state-subtext">
                Use "Load Code" to import existing bets or "Add Game" to create
                new ones
              </p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <div id="filter-canvas"></div>
    <div id="mobile-nav"></div>
    <div id="betslip-rail"></div>

    <script src="assets/js/adminux/adminux-dashboard.js"></script>
    <script src="./components/AppLayout.js"></script>
    <script src="./components/betslip-rail.js"></script>
    <script src="./components/market-edit-modal.js"></script>
    <script>
      // ==================== WAIT FOR RAIL TO BE READY ====================
      function waitForRail() {
        return new Promise((resolve) => {
          if (window.betslipRail) {
            resolve();
          } else {
            const checkInterval = setInterval(() => {
              if (window.betslipRail) {
                clearInterval(checkInterval);
                resolve();
              }
            }, 50);
          }
        });
      }

      // ==================== NAVIGATION ====================
      async function setupNavigation() {
        await waitForRail();

        const loadCodeBtn = document.getElementById("load-code-btn");
        const addGameBtn = document.getElementById("add-game-btn");

        loadCodeBtn.addEventListener("click", () => {
          console.log(
            "Load Code clicked, Rail available:",
            !!window.betslipRail
          );

          // FIXED: Just open the rail - the empty state will show the load form
          if (window.betslipRail && window.betslipRail.openRail) {
            window.betslipRail.openRail();
          } else {
            console.warn("Rail not ready, falling back to navigation");
            window.location.href = "bet-editor-load.html";
          }
        });

        addGameBtn.addEventListener("click", () => {
          window.location.href = "bet-editor-add.html";
        });
      }

      // ==================== UI STATE MANAGEMENT ====================
      async function updateUIState() {
        await waitForRail();

        const bets = window.betslipRail ? window.betslipRail.getBets() : [];
        const emptyState = document.getElementById("empty-state");
        const infoCard = document.getElementById("info-card");
        const betCountInfo = document.getElementById("bet-count-info");

        if (bets.length === 0) {
          // Show empty state
          if (emptyState) emptyState.style.display = "block";
          if (infoCard) infoCard.style.display = "none";
        } else {
          // Show info card
          if (emptyState) emptyState.style.display = "none";
          if (infoCard) {
            infoCard.style.display = "block";
            if (betCountInfo) betCountInfo.textContent = bets.length;
          }
        }
      }

      // ==================== OPEN BETSLIP ====================
      async function setupOpenBetslip() {
        await waitForRail();

        const openBetslipBtn = document.getElementById("open-betslip-btn");
        if (openBetslipBtn) {
          openBetslipBtn.addEventListener("click", () => {
            if (window.betslipRail && window.betslipRail.openRail) {
              window.betslipRail.openRail();
            }
          });
        }
      }

      // ==================== LISTEN TO BETSLIP UPDATES ====================
      document.addEventListener("betslip:updated", (e) => {
        updateUIState();
      });

      document.addEventListener("betslip:cleared", (e) => {
        updateUIState();
      });

      // ==================== INITIAL STATE ====================
      window.addEventListener("DOMContentLoaded", async () => {
        // Wait for Rail to be ready
        await waitForRail();

        // Setup all interactions
        await setupNavigation();
        await setupOpenBetslip();

        // Update UI state
        updateUIState();
      });

      // ==================== PAGE VISIBILITY (Sync across tabs) ====================
      document.addEventListener("visibilitychange", () => {
        if (!document.hidden) {
          updateUIState();
        }
      });
    </script>
  </body>
</html>
